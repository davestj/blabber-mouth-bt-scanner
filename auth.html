<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTHL - Blabber Mouth BT Scanner - Authentication</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/auth.css">
</head>
<body>
    <div class="grid-background"></div>
    
    <div class="auth-container">
        <div class="logo-section">
            <div class="logo-badge">
                <i class="fas fa-satellite-dish"></i>
            </div>
            <div class="agency-text">BEYOND THE HORIZON LABS</div>
            <div class="system-name">Blabber Mouth BT Scanner</div>
            <div class="classification">CLASSIFIED - LEVEL 5</div>
        </div>

        <div class="auth-panel">
            <div class="loading-overlay">
                <div class="loading-spinner"></div>
            </div>

            <div class="error-message" id="errorMsg">
                <i class="fas fa-exclamation-triangle"></i> ACCESS DENIED - Invalid Credentials
            </div>

            <form id="authForm">
                <div class="input-group">
                    <label class="input-label">Operator ID</label>
                    <i class="fas fa-user-shield input-icon"></i>
                    <input type="text" class="tactical-input" id="username" placeholder="Enter secure ID" autocomplete="off" required>
                </div>

                <div class="input-group">
                    <label class="input-label">Access Code</label>
                    <i class="fas fa-key input-icon"></i>
                    <input type="password" class="tactical-input" id="password" placeholder="Enter access code" required>
                </div>

                <button type="submit" class="auth-button">
                    <i class="fas fa-shield-alt"></i> AUTHENTICATE
                </button>
            </form>

            <div class="security-features">
                <div class="feature-badge">
                    <i class="fas fa-lock"></i>
                    <span>AES-256</span>
                </div>
                <div class="feature-badge">
                    <i class="fas fa-fingerprint"></i>
                    <span>Biometric Ready</span>
                </div>
                <div class="feature-badge">
                    <i class="fas fa-shield-virus"></i>
                    <span>Quantum Safe</span>
                </div>
            </div>
        </div>

        <div class="auth-footer">
            <div>U.S. DEPARTMENT OF DEFENSE - AUTHORIZED PERSONNEL ONLY</div>
            <div class="version-info">Version 1.0.0 | Build 2025.08.10</div>
        </div>
    </div>

    <script>
        /*
         * File: auth.js
         * Author: David St John
         * Date: 2025-08-10
         * Purpose: Handle authentication for BTHL Scanner
         * We will integrate this with the Electron IPC for secure auth
         */

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');
            const loadingOverlay = document.querySelector('.loading-overlay');
            
            // Show loading state
            loadingOverlay.classList.add('active');
            errorMsg.classList.remove('active');
            
            // Check if running in Electron with IPC
            if (window.bthlAPI && window.bthlAPI.auth) {
                try {
                    const result = await window.bthlAPI.auth.authenticate(username, password);
                    
                    if (result && result.success) {
                        console.log('Authentication successful');
                        await window.bthlAPI.auth.navigateToDashboard();
                    } else {
                        errorMsg.classList.add('active');
                        loadingOverlay.classList.remove('active');
                    }
                } catch (error) {
                    console.error('Authentication error:', error);
                    errorMsg.classList.add('active');
                    loadingOverlay.classList.remove('active');
                }
            } else {
                // Fallback for testing without Electron
                const { verifyCredentials } = require('./credentials');
                const { login } = require('./session');
                
                if (verifyCredentials(username, password)) {
                    const token = login(username, password);
                    if (token) {
                        console.log('Authentication successful');
                        window.location.href = 'dashboard.html';
                    }
                } else {
                    errorMsg.classList.add('active');
                    loadingOverlay.classList.remove('active');
                }
            }
        });

        // Add input focus effects
        document.querySelectorAll('.tactical-input').forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.querySelector('.input-icon').style.color = 'var(--electric-blue)';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.querySelector('.input-icon').style.color = 'var(--tactical-blue)';
            });
        });
    </script>
</body>
</html>
